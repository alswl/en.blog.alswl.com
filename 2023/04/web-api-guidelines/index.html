<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Pragmatic web API guidlines | Log4D</title>
<meta name="keywords" content="rest, api, http, Guidelines">
<meta name="description" content="When starting to create a new system, or participating in a new team or project, there is a simple but profound question: Is there a design specification for the API of this system (Web Server)?
image by stable difussion, prompt by alswl
This issue has bothered me for a long time, starting during my school days, and every time I needed to communicate and discuss with my team members. From the initial free style to the later REST, I often referenced Github v3 to the project team and the Foursqure API (no longer accessible, exposing age) documentation.">
<meta name="author" content="alswl">
<link rel="canonical" href="https://en.blog.alswl.com/2023/04/web-api-guidelines/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f554980c9f09b56c864c77f573830357380079214160ec32b8701d5358d6337a.css" integrity="sha256-9VSYDJ8JtWyGTHf1c4MDVzgAeSFBYOwyuHAdU1jWM3o=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://en.blog.alswl.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://en.blog.alswl.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://en.blog.alswl.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://en.blog.alswl.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://en.blog.alswl.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QLEQ62FMM1"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-QLEQ62FMM1', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Pragmatic web API guidlines" />
<meta property="og:description" content="When starting to create a new system, or participating in a new team or project, there is a simple but profound question: Is there a design specification for the API of this system (Web Server)?
image by stable difussion, prompt by alswl
This issue has bothered me for a long time, starting during my school days, and every time I needed to communicate and discuss with my team members. From the initial free style to the later REST, I often referenced Github v3 to the project team and the Foursqure API (no longer accessible, exposing age) documentation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://en.blog.alswl.com/2023/04/web-api-guidelines/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-03T11:34:18+08:00" />
<meta property="article:modified_time" content="2023-04-03T11:34:18+08:00" /><meta property="og:site_name" content="Log4D" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pragmatic web API guidlines"/>
<meta name="twitter:description" content="When starting to create a new system, or participating in a new team or project, there is a simple but profound question: Is there a design specification for the API of this system (Web Server)?
image by stable difussion, prompt by alswl
This issue has bothered me for a long time, starting during my school days, and every time I needed to communicate and discuss with my team members. From the initial free style to the later REST, I often referenced Github v3 to the project team and the Foursqure API (no longer accessible, exposing age) documentation."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://en.blog.alswl.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Pragmatic web API guidlines",
      "item": "https://en.blog.alswl.com/2023/04/web-api-guidelines/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Pragmatic web API guidlines",
  "name": "Pragmatic web API guidlines",
  "description": "When starting to create a new system, or participating in a new team or project, there is a simple but profound question: Is there a design specification for the API of this system (Web Server)?\nimage by stable difussion, prompt by alswl\nThis issue has bothered me for a long time, starting during my school days, and every time I needed to communicate and discuss with my team members. From the initial free style to the later REST, I often referenced Github v3 to the project team and the Foursqure API (no longer accessible, exposing age) documentation.",
  "keywords": [
    "rest", "api", "http", "Guidelines"
  ],
  "articleBody": "When starting to create a new system, or participating in a new team or project, there is a simple but profound question: Is there a design specification for the API of this system (Web Server)?\nimage by stable difussion, prompt by alswl\nThis issue has bothered me for a long time, starting during my school days, and every time I needed to communicate and discuss with my team members. From the initial free style to the later REST, I often referenced Github v3 to the project team and the Foursqure API (no longer accessible, exposing age) documentation. However, in practice, there are still cases where there is a mismatch with the actual work or the common company specification. This is when I need to do some additional work. Eventually, I will write a brief DEVELOPMENT.md document to describe the design solution.\nBut I’ve always had more ideas for that document, and it’s not quite good enough. So, I wanted to put together a Simple and Pragmatic Web API best practice, which is this article.\nWhy We Need API Uniformity Specifications The problem seems obvious, but a deeper analysis involves teamwork efficiency and engineering design philosophy.\nAPI (Application Programming Interface) is the bridge between different software systems to interact with each other. When communicating between different software systems, the APIs allow data transfer and processing in a standardized way, enabling the integration of various applications.\nWhen we start writing API documentation, a paradigm (Design Pattern) emerges, whether it is explicit or implicit, whether Whether it is one set for each or a common set. This is just like when we use a unified USB interface, unification reduces costs and avoids possible errors. Specifically, there are several reasons for this:\nEase of understanding and efficiency: service providers and consumers use a unified form, structure and usage, and a unified production-consumption protocol, thus reducing communication costs. Expert experience: It contains best engineering practices with corresponding solutions for common scenarios, avoiding the need for everyone to rethink the entire API system. For example, how do you handle API caching? How to perform authentication? How to handle data formatting? Extensibility: extensibility require stable protocols, protocols are abstract and implementation-independent, and not everyone has them The ability to design uncertainty-oriented systems, and some widely used technologies plan for a wider range of scenarios. image by alswl\nWhile it is true that there are some costs associated with the use of a unified specification that requires framework understanding and promotion, I believe that in most scenarios the benefits of a unified specification far outweigh these costs.\nHowever, not all cases require consideration of the API specification. For short lifecycle projects, internal projects and products with a very small impact specifications may not require much attention. In addition, in some special business scenarios, the The underlying protocol may change, and the existing specification may no longer be applicable. But even so, I still recommend redrafting a new specification, rather than abandoning it.\nPrinciples of rules When developing API specifications, we should follow some basic principles to deal with technical differences, and I have summarized three principles that have gained wide acceptance:\nSimplicity: Simplicity is the most direct and effective strategy to resist complexity, using the principle of simplicity to reduce complexity and avoid the breeding and proliferation of complexity; Consistency: uniform design patterns and continuity of design styles help reduce engineering costs and the psychological burden on engineers; follow reality: follow the abstractions and layering of existing engineering domains (e.g. HTTP, REST, RBAC, OIDC, etc.) and do not invent new concepts of your own. Always think about whether the problem is the only one you have encountered (the answer is definitely no). image by alswl\nDoes REST work or not? The RESTful API has become a popular protocol in the Web API space. Its broad applicability and reach stems from its binding to the HTTP protocol, which allows RESTful APIs to easily interact with existing Web technologies. If you are not familiar with REST, you can check out [Yifeng Ruan’s You can check out Yifeng Ruan’s RESTful API Design Guide and Best Practices for RESTful API Design.\nREST is a high maturity protocol, which Leonard Richardson describes it as having four levels of maturity:\nimage by alswl\nThe Swamp of POX, using HTTP to host the Legacy protocol (XML) Resources: using resource abstraction HTTP Verbs: using rich HTTP Verbs Hypermedia Controls: API resource integration using rel links, JSON:API is the pinnacle of performance The core strength of REST is that\nIt takes full advantage of the design of the HTTP Protocol (HTTP Protocol) It has excellent identification of resources It is designed with complete manipulation of resources (Manipulation of resources) It has Self-descriptive messages It supports multiple forms of presentation (hypermedia as the engine of application state) However, REST is not a specific protocol or specification, but a style philosophy. While REST defines rules and principles such as the identification of resources, unified interfaces, stateless communication, etc., it does not prescribe a specific protocol or specification. it does not prescribe a specific way to implement them. As a result, in practice, different teams may have different understandings and practices, leading to inconsistencies and portability of the API. This leads to inconsistency and reduced maintainability of the API.\nIn addition, REST has a number of limitations and drawbacks:\nNot all requests can be described by resources, such as the login (/login) operation, which is very convoluted when converted to session; The same problem arises for operations like money transfers, where the limited number of HTTP verbs cannot support all business scenarios. REST does not provide a clear solution to the inevitable problems such as paging, specific structure of the return body, error handling and authentication, etc. For complex queries (such as Search Search), the query parameters of the RESTful API can become very complex and difficult to maintain. Therefore, although the REST style is a good guideline, the specific implementation needs to be combined with specific business requirements and technical features to make some trade-offs in order to achieve a good API design. Finally, do we need a Web API design specification that follows the REST style? I think REST can solve 90% of the problems, but there is still 10% need to specify the details.\nWeb API specification multiple choice questions Since our protocol is based on HTTP and REST design, we will base our discussion on the four core parts of an HTTP request: URL, Header, Request and Response. These are: URL, Header, Request and Response.\nURL Best Practices My inspiration for URL design came from Ruby on Rails. Before that, I always instinctively put model information on top of URLs, but in reality good URL design should be a plan for the information structure of the system. Therefore, URL design should consider not only the API, but also the user-oriented Web URL.\nTo achieve good URL design, I have summarized the following rules:\nLocate resources (this answers the question of whether paging should be in the Header) Self-explanatory (readable, the URL itself contains the core information) Security (can not contain user authentication information, OAuth spent a lot of effort to understand this, anti-forgery) Typically, the URL model is as follows:\n/$(prefix)/$(module)/$(model)/$(sub-model)/$(verb)?$(query)#${fragment}\nwhere Prefix may be the version of the API, or it may be a special qualification, as some companies rely on for access layer triage; Module is a business module, which can also be omitted; Model is a model; SubModel is a submodel, which can be omitted; Verb is a verb, which can also be omitted; Query is a request parameter; Fragment is an HTTP primitive Fragment.\nIt is important to note that not all components are required to appear. For example, fields such as SubModel and Verb can be allowed to be hidden in different URL styles.\nDesign Style Options\nNote: Please note that there is no association between Scenario A / B / C and no association above or below each line\nProblem Explanation (see separate analysis below) Option A Option B Option C Dos API path’s prefix /apis /api second-level domain Does the path contain the API version Version advantage in URLs ✅ 🚫 Does path contain a group ✅ 🚫 Whether path contains action HTTP Verb is not enough ✅ 🚫 (pure REST) Depends (include if HTTP Verb CRUD cannot be satisfied) Model ID form Readable Stable Identity explained Self-incrementing ID GUID Readable Stable ID Model singular or plural in URL Singular Plural List Plural, One-Way Singular Is the resource one-level (tiled) or multi-level (nested) Explanation of one-level and multi-level One-level (tiled) Multi-level (nested) How is search implemented, standalone API (/models/search) or list-based /models/ API standalone list-based Does it have an Alias URL Alias URL explanation ✅ 🚫 Does the model in the URL allow abbreviations (or refinements) Model abbreviations explained ✅ 🚫 Hyphenation of multiple words of the model in the URL - _ Camel Whether to distinguish between Web API and Open API (non-browser oriented) ✅ 🚫 Version advantage in URLs\nWe follow the principle of consistency when designing URLs; the same URL is used to access the same resource, regardless of identity or state. This is also the basic principle of Uniform Resource Location. While we can accept different content formats (e.g. JSON / YAML / HTML / PDF / etc.) but we want the location of the resource to be unique.\nHowever, the question is, should the same resource be reflected in the URL for rendering between versions? This depends on whether the designer considers versioning to be in the realm of location information.\nAccording to the RFC design, in addition to the URL there is URN (Uniform Resource Name). The latter is used to identify the resource, while the URL points to the resource address. In practice, URNs are not so widely used that URIs are almost equivalent to URLs.\nHTTP Verb is not enough\nIn REST design, we need to operate on resources using HTTP verbs like GET / POST / PUT / DELETE / PATCH / HEAD. For example, using the API GET /apis/books to view book listings is natural and reasonable. However, when it comes to performing an action like “borrow a book we don’t have a suitable verb (BORROW) to represent it. In this case, there are two possible options:\nuse the POST method with a custom verb, such as POST /apis/books/borrow, for the action of borrowing a book; creating a book borrow log, using a resource add method to structure the non-existent action, e.g. POST /apis/books/borrow-log/; This issue comes up a lot in complex scenarios such as user login (POST /api/auth/login vs POST /api/session) and account transfers (vs transfer record creation), etc. API abstract or concrete, there is always an explanation of the business. We can’t simply generalize all of our business to CRUD. Rather, we need to divide the business wisely to make it clearer and more understandable to users.\nWhen designing, we can consider whether we need to create a corresponding button for each API to make it easier for users to do so. If there is only one API named /api/do and all the services are bound to it, although technically possible, this design does not meet the business requirements. Each layer of abstraction is designed to standardize the solution to a particular problem, and the TCP L7 design is a reflection of this philosophy.\nReadable Stable Identity explained\nWhen marking a resource, we typically have several options:\nUse ID: IDs are usually bound to database self-incrementing IDs. Use a GUID: such as a UUID, although less precise. Use Readable Stable Identity: Usually identified by name, UID, or a specific ID such as a host name, IP address, or serial number. This identifier is required to be stable and globally unique, which is useful in internal systems. I have a personal design tip: use a slug of the form ${type}/${type-id} to describe an identifier. For example hostname/abc.sqa or ip/172.133.2.1. This design approach provides a good balance between readability and uniqueness.\nA slug is a human-readable, unique identifier, used to identify a resource instead of a less human-readable identifier like an id .\nfrom What’s a slug. and why would I use one? | by Dave Sag\nPS: At the end of the article I’ll also introduce an Apple Music solution that combines the ID / Readable / Stable features.\nExplanation of one-level and multi-level\nThe hierarchical design of URLs can be based on modeling, or a straightforward single-level structure can be used. specific problem solving approach. For example, when designing user-owned books, one can choose a multi-level structure /api/users/foo/books or a one-level structure /api/books?owner=foo.\nBoth options are technically possible, the former respecting the attribution of the model, and the latter focusing on the simplicity of the URL structure.\nA multi-level structure is more intuitive, but also needs to address the issue of possible multiple ways of organization, such as books in a library organized by author or category? In this case, consider making the attribution of models explicit in a multi-level structure For example /api/author/foo/books (based on authors) or /api/category/computer/books (based on categories).\nAlias URL explanation\nFor some frequently used URLs, although they can be designed according to URL rules, we can still design a more concise URL that to facilitate user presentation and use. This design is especially common for Web URLs. For example, the API for a library’s most popular books:\n# Original URL https://test.com/apis/v3/books?sort=hot\u0026limit=10 # Alias URL https://test.com/apis/v3/books/hot Model abbreviations explained\nOften, when modeling resources, longer names are used to name them, for example a book index might be named BookIndex instead of Index. When rendering in URLs, since the URL prefix of /book/book-index contains Book, we can reduce the layer of description and We can make the URL more concise, for example by using /book/index. This technique is very common in Web URL design.\nThere is also a strategy of model abbreviation, which provides a complete set of alias registration schemes. aliases that are globally unique. For example, in Kubernetes, Deployment is a common naming, while apps/v1/Deployment is the full name by adding a Group restriction. There is also a shorthand for deploy. This mechanism relies on Kubernetes’ API Schema system for registration and work.\nHeader Best Practices We often overlook the importance of the Header. In fact, the selection of HTTP verbs, HTTP status codes, and various authentication logic (e.g., cookies / Basic Auth / Berear Token) all depend on the design of the Header. In fact, the selection of HTTP verbs, HTTP status codes, and various identity verification logic (e.g., Cookie / Basic Auth / Berear Token) all depend on the design of the Header.\nDesign style selection\nProblem Explanation (see separate analysis below) Option A Option B Option C Are all verbs using POST About only using POST ✅ 🚫 Is the Modify action POST or PATCH? POST PATCH HTTP status return code 2XX family Make full use of HTTP Status Use only core status (200 404 302, etc.) Use only 200 Is using rate limiter system ✅ 429 🚫 Is using cache system ✅ ETag / Last Modify 🚫 Is validate UserAgent ✅ 🚫 Is validate Referrral ✅ 🚫 About only using POST\nSome novices (or those who consider themselves experienced) may come to the erroneous conclusion that, with the exception of GET requests all HTTP requests should use the POST method. Some even demand that all actions (even read-only requests) should use the POST method. This argument is often supported on the grounds of “simple consistency”, “cache avoidance”, or “operator requirements”.\nHowever, it is important to understand the original design of the HTTP method: it is used to describe the type of resource manipulation that gives rise to a number of issues including caching, security, and idempotency. In relatively simple scenarios, omitting this layer of abstraction really doesn’t pose much of a problem, but once you get into the complexities of the domain, the Using this layer of abstraction for HTTP methods becomes very important. Whether this follows the standard or not will determine whether you get the benefits of standardization. The analogy is like a new phone manufacturer that can choose not to use the USB TypeC interface. It’s technically possible, but it also loses a lot of standardization support and mental agreement.\nI especially like one Knowing user’s comment: “Routing hasn’t gone away, it’s just shifted.\n2XX family\nThe purpose of HTTP status codes is to indicate the result of communication between the client and the server. 2XX status code family means that the server has successfully received, understood, and processed the client request, understood and processed the client request, and the response was successful. The following are common status codes in the 2XX family and their meanings:\n200 OK: The request was processed successfully and the server returned a response. 201 Created: The request has been successfully processed and a new resource has been created on the server. 202 Accepted: The request has been accepted by the server, but not yet executed. This status code is typically used for asynchronous processing. 204 No Content: The request was processed successfully, but the server did not return any response body content. The 2XX family of status codes indicates that the request has been successfully processed. These status codes let the client know explicitly that the request has been processed correctly so that it can proceed to the next step.\nThe need to use the 2XX family of status codes across the board depends on whether the client needs to be explicitly/displayed with information that inform it of the next action. If it has been clearly described by other means (including documentation, verbal agreements) then it is indeed possible to use 200 status codes across the board for return. But passing meaning based on behavior. or document-based (or even verbal)? Is it more complex or more concise?\nRequest Best Practices Design style selection\nProblem Explanation (see separate analysis below) Option A Option B Option C Whether complex parameters are put into Form Fields or a separate JSON Body Form Fields Body Whether the subresource is a one-time query or an independent query one-time independent Paging parameter storage Header URL Query Paging parameter method Explanation of paging method Page based Offset based Continuation token Paging Controllers Paging controller explanation Client Server Explanation of paging methods\nThe two most common types of paging we see are Page-based and Offset-based, which can be mapped by formula. In addition, there exists a method called Continuation Token, which is similar in technique to Oracle’s rownum paging scheme, using the parameter start-from=? to describe it. While the advantages and disadvantages of Continuation Token are significant, using this approach allows sequential to be used as an alternative to random.\nPaging controls interpretation.\nIn some cases, we need to distinguish between Client Pagination and Server Pagniation. Client Pagination means that the parameters of the next page are calculated by the client, while Server Pagination is a protocol such as rel or JSON.API returned by the server. Using Server Pagniation avoids some problems, such as bulk blocking of some content, which may result in missing pages or white screens if client-side paging is used.\nResponse Best Practices Design Style Selection\nProblem Explanation (see separate analysis below) Option A Option B Option C Model presentation types Several forms of models Single model Multiple models How large models contain sub-model models Linking, sidecar, and embedding of models Embedding Core model + multiple linked resource queries Linking Whether field returns are on-demand or grouped or unified unified Use the fields field on demand field presentation format Snake Camel Error code No customization, use Message Custom Error format global uniform on-demand Time Zone UTC Local Local + TZ HATEOAS ✅ 🚫 Several forms of models\nIn API design, there are several definitions for how models should be represented. Although this is not a topic that must be discussed in the API specification, it is very important for API design.\nI have divided the model presentation that models are often described into the following categories, which are not professionally defined and borrow some definitions from the Java context below. These names will be called differently in different companies and even different teams:\nimage by alswl\nBusiness Object (BO): the original business model Data Object (DO): the model stored to the RDBMS, so it must be a flat field structure, sometimes a BO will correspond to multiple DOs View Object (VO): the model presented to the presentation layer, only keep the information the user needs to see, such as sensitive information will be removed Data Transfer Object (DTO): the model used to transfer in the RPC system, generally not much different from the original Model, depending on the different serialization systems will have differences (such as the handling of enumerations) In addition, two other categories are often used: Rich Model and Tiny Model (please ignore the naming, it varies a lot from team to team):\nRich Model: This model is used to describe a rich model, which contains almost all the data needed and allows nesting of sub-resources. Tiny Model: is a compact model, often used in the list API to be used Linking, sidecar, and embedding of models\nIn API design, we often need to deal with cases where a model contains multiple submodels, such as a Book containing Comments. For this case, there are usually three representations to choose from: Link, Side, and Embed.\nimage by alswl\nLinking (sometimes this URL is also hidden, based on an implicit protocol between client and server for requests):\n{ \"data\": { \"id\": 42, \"name\": \"朝花夕拾\", \"relationships\": { \"comments\": \"http://www.domain.com/book/42/comments\", \"author\": [ \"http://www.domain.com/author/鲁迅\" ] } } } Sidecar:\n{ \"data\": { \"id\": 42, \"name\": \"朝花夕拾\", \"relationships\": { \"comments\": \"http://www.domain.com/book/42/comments\", \"authors\": [ \"http://www.domain.com/author/鲁迅\" ] } }, \"includes\": { \"comments\": [ { \"id\": 91, \"author\": \"匿名\", \"content\": \"非常棒\" } ], \"authors\": [ { \"name\": \"鲁迅\", \"description\": \"鲁迅原名周树人\" } ] } } Embedding:\n{ \"data\": { \"id\": 42, \"name\": \"朝花夕拾\", \"comments\": [ { \"id\": 91, \"author\": \"匿名\", \"content\": \"非常棒\" } ], \"authors\": [ { \"name\": \"鲁迅\", \"description\": \"鲁迅原名周树人\" } ] } } Others There are some other issues that are not converged in the four elements, but we often encounter them in engineering practice, and I will run them out:\n**I’m not in the HTTP protocol, what should I do? ** I’m not in the HTTP protocol, what should I do?\nNon-HTTP protocols are less commonly encountered in Web APIs, and the cost of creating a new set of protocols is too high. There are protocols that are introduced in certain areas. For example, MQTT in the IoT domain.\nIn addition, RPC is a wide-ranging concept that goes far beyond the protocol level. Often we compare the transport protocols of HTTP and RPC, as well as serialization protocols. I believe that much of the discussion in this paper is also of importance to the RPC community.\nSome teams or individuals plan to use protocols that they create themselves, but my opinion is that self-built protocols should be avoided as much as possible, because it is very rare that there is a real need to create a protocol. If a strong need does exist, then I would ask two questions: Have you read through the HTTP RFC document and the HTTP/2 RFC document?\n**I’m not a remote service (RPC / HTTP etc.), but what about the SDK? ** This article focuses on Web APIs (RPC/ HTTP etc.).\nThis article focuses on the design specifications of the Web API (HTTP) and some of the rules can be applied to RPC systems. However, the basis of the discussion is based on Remote Service. If you are an SDK developer, you will have two roles, possibly as a client communicating with a remote server, and as an SDK providing developer-oriented services. You will also provide developer-facing interfaces as an SDK. For the latter, the following specifications can be used as a reference:\nFor the latter, you can refer to these specifications:\nAzure SDK Design Specifications General Guidelines: API Design | Azure SDKs Posix API examples (e.g. File Low-Level I/O (The GNU C Library)) Authentication Authentication Scheme\nIn general, the Web API design will clearly describe the authentication and authentication system to be used. It is important to distinguish between the concepts of “authentication” and “authentication”. The topic of “authentication” can be discussed in a separate section, so this paper will not cover this aspect.\nIn Web API design, common authentication methods include HTTP Basic Auth, OAuth2, and account password login. In addition, HMac algorithm-based anti-replay and anti-tampering schemes are used for anti-tampering.\nOverlooked Topics\nIn this discussion, I did not cover the following topics: asynchronous protocols (Web Sockets / Long Pulling / Round Trials), CORS, and security issues. Although these topics are important, they will not be covered in this article.\nWhen to break the rules\nSome developers believe that rules are there to be broken. The reality is often so complex that it is difficult to discuss the details. If a developer feels that a rule does not meet the actual need, there are two ways to handle it: change the rule or break it. However, I prefer to discuss and update the rules, clarify where the specification is inadequate, and determine if there are special cases. If a special case does need to be created, be sure to describe it in detail in the documentation, informing the successor and the consumer that it is a special case, explaining why the special case was created and how the special case responds.\nA style Checklist Github style Github’s API is one that I often refer to. It models its business domain very clearly, provides thorough documentation, and makes communication much less costly. I mainly refer to the following two links: API Definition GitHub REST API documentation and a list of application-oriented APIs [Endpoints available for GitHub Apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps? apiVersion=2022-11-28) This list includes almost all of Github’s APIs.\nProblem Choice Comment URL Dos API path’s prefix second-level domain https://api.github.com Does the path contain the API version 🚫 Header X-GitHub-Api-Version API Versions Does path contain a group 🚫 Whether path contains action Depends (include if HTTP Verb CRUD cannot be satisfied) sample: /repos/{owner}/{repo}/pulls/{pull_number}/merge POST /repos/{owner}/{repo}/releases/generate-notes Model ID form Readable Stable Identity Model singular or plural in URL Plural Is the resource one-level (tiled) or multi-level (nested) multi-level How is search implemented, standalone API (/models/search) or list-based /models/ API standalone Does it have an Alias URL ? Does the model in the URL allow abbreviations (or refinements) 🚫 No obvious information is seen, and it is not required based on the multilevel model, but it exists GET /orgs/{org}/actions/required_workflows Hyphenation of multiple words of the model in the URL - and _ GET /repos/{owner}/{repo}/git/matching-refs/{ref} vs GET /orgs/{org}/actions/required_workflows Whether to distinguish between Web API and Open API (non-browser oriented) 🚫 Header Are all verbs using POST 🚫 Is the Modify action POST or PATCH? PATCH HTTP status return code Leverage HTTP Status Commonly used, including rate limiter Is using rate limiter system ✅ 429 Is using cache system ✅ ETag / Last Modify Resources in the REST API#client-errors Is validate UserAgent ✅ Is validate Referrral 🚫 Request Whether complex parameters are put into Form Fields or a separate JSON Body Body for example, Pulls#create-a-pull-request Whether the subresource is a one-time query or an independent query one-time Judging from Pulls Paging parameter storage URL Query Whether complex parameters are put into Form Fields or a separate JSON Body Page Using pagination in the REST API Whether the subresource is a one-time query or an independent query Server Using pagination in the REST API Response Model presentation types Multi For example, the details in Commits and Parent Commits How large models contain sub-model models Core Model + Multiple Linked Resource Queries Not explicitly stated, inferred from several core APIs Whether field returns are on-demand or grouped or unified Unified field presentation format Snake Error code None Resources in the REST API#client-errors Error format Global Harmonization Resources in the REST API#client-errors Time Zone Multi（ISO 8601 \u003e Time-Zone Header \u003e User Last \u003e UTC） Resources in the REST API#Timezones Azure style Azure’s API design follows [api-guidelines/Guidelines.md at master - microsoft/api-guidelines](https://github.com/Microsoft/api-guidelines/blob/ master/Guidelines.md). This article is schematic, and there is also a practical guide at [Best practices in cloud applications](https://learn.microsoft.com/en-us/azure/architecture/best-practices/index -best-practices) and Web API design best practices.\nNote that Azure’s product line is much richer than Github, and some APIs do not follow Azure’s own specifications. When looking for examples, I mainly refer to REST API Browser, the Azure Storage REST API Reference. If the specific implementation conflicts with the Guidelines.md, I will use the Guidelines.md conclusion.\nProblem Choice Comment URL Dos API path’s prefix Second level domain Does the path contain the API version 🚫 x-ms-version Does path contain a group ✅ Whether path contains action 🚫？ Not explicitly stated, but there is a tendency to use the comp parameter for actions that keep the URL RESTful Reference Lease Container (REST API) - Azure Storage Model ID form Readable Stable Identity Guidelines.md#73-canonical-identifier Model singular or plural in URL Plural Guidelines.md#93-collection-url-patterns Is the resource one-level (tiled) or multi-level (nested) one-level (tiled) / multi-level (nested) api-design#define-api-operations-in-terms-of-http-methods, note MS has comp=? parameter, which is used to handle special commands How is search implemented, standalone API (/models/search) or list-based /models/ API ? Tends to be list-based because of the heavy use of comp= this URL Param for subcommands such as Incremental Copy Blob (REST API) - Azure Storage Does it have an Alias URL ? Does the model in the URL allow abbreviations (or refinements) ? Hyphenation of multiple words of the model in the URL Camel Job Runs - List - REST API (Azure Storage Mover) Whether to distinguish between Web API and Open API (non-browser oriented) 🚫 Header Are all verbs using POST 🚫 Is the Modify action POST or PATCH? PATCH Agents - Update - REST API (Azure Storage Mover) HTTP status return code Leverage HTTP Status Guidelines.md#711-http-status-codes Is using rate limiter system ? Is using cache system ✅ Guidelines.md#75-standard-request-headers Is validate UserAgent 🚫 Is validate Referrral 🚫 Request Whether complex parameters are put into Form Fields or a separate JSON Body Body Reference Agents - Create Or Update - REST API (Azure Storage Mover) Whether the subresource is a one-time query or an independent query ? Paging parameter storage ? No conclusion Whether complex parameters are put into Form Fields or a separate JSON Body Page based Whether the subresource is a one-time query or an independent query Server Agents - Create Or Update - REST API (Azure Storage Mover) Response Model presentation types Sginle Speculation How large models contain sub-model models ? Overly complex scenarios with no single conclusion Whether field returns are on-demand or grouped or unified ? field presentation format Camel Error code Use the list of custom error codes At least within their respective products Error format Customization Time Zone ? HATEOAS ? api-design#use-hateoas-to-enable-navigation-to-related-resources The overall design style of Azure is more complex than the Github API, and there are multiple versions of the same product, making it a little less uniform. It looks a little less uniform. It is also more difficult to have a single specification that binds all teams in this complex scenario. We can see that the Azaure team is working on the Guidelines, and they are recently launching the vNext specification.\nMy personal style My personal style is basically inherited from the Github API style, with some minor adjustments to make it more suitable for small and medium-sized product development. The reasons for my changes are explained in the notes, and the starting point for changes is: simplify / reduce ambiguity / consider the actual cost. If “Note” is marked in the notes, it follows the Github scheme and adds some ideas.\nProblem Choice Comment URL Dos API path’s prefix /apis We often have only one system, one domain name to host the API and Web Page Does the path contain the API version ✅ Does path contain a group ✅ Do a layer of business module split to isolate certain cooperation boundaries Whether path contains action Depends (include if HTTP Verb CRUD cannot be satisfied) Model ID form Readable Stable Identity Model singular or plural in URL Plural Is the resource one-level (tiled) or multi-level (nested) Multi-level + One-level Note: 80% of cases follow the model attribution, a few cases (commonly in search) use the first level How is search implemented, standalone API (/models/search) or list-based /models/ API Uniform \u003e Standalone Low-cost implementation of some (early Github issues were also without /search interface) Does it have an Alias URL 🚫 Keep it simple. Does the model in the URL allow abbreviations (or refinements) ✅ Once the streamlining is done, it needs to be marked in the glossary Hyphenation of multiple words of the model in the URL - Whether to distinguish between Web API and Open API (non-browser oriented) 🚫 Header Are all verbs using POST 🚫 Is the Modify action POST or PATCH? PATCH HTTP status return code Leverage HTTP Status Is using rate limiter system ✅ 429 Is using cache system 🚫 Keep it simple, use dynamic data, remove caching capabilities Is validate UserAgent ✅ Is validate Referrral 🚫 Request Whether complex parameters are put into Form Fields or a separate JSON Body Body Whether the subresource is a one-time query or an independent query one-time Paging parameter storage URL Query Whether complex parameters are put into Form Fields or a separate JSON Body Page Whether the subresource is a one-time query or an independent query Client Reduce server-side costs and tolerate extreme case gaps Response Model presentation types Multi BO / VO / Tiny / Rich How large models contain sub-model models Core Model + Multiple Linked Resource Queries Whether field returns are on-demand or grouped or unified Unified Tiny Model (optional) / Model (default) / Rich Model (optional) field presentation format Snake Error code None Note: Many scenarios require only message Error format Uniform Time Zone ISO 8601 Use only one format, no longer support multiple options HATEOAS 🚫 Off-Topic - An Interesting Design for Apple Music image from Apple Music\nI was recently using Apple Music and noticed the URL structure of its web page:\n/cn/album/we-sing-we-dance-we-steal-things/277635758?l=en\nLooking closely at this URL structure, I can see that the Path contains human-readable slug in three parts: alumn/$(name)/$(id) (which contains the ID). A question immediately occurred to me: are the intermediate readable names machine-sensitive and purely geared towards natural humans? So I tested a fabricated address: /cn/album/foobar/277635758?l=en. Can you guess if the result is accessible before you try to access it?\nThis design paradigm is a bit more complex than my current common URL design specification. My specification requires that the resource locale be organized using a two-level slug, $(type)/$(id). Whereas Apple uses $(type)/(type-id)/$(id), taking care of both readability and accuracy.\nOff-Topic - Why GraphQL Doesn’t Work GraphQL is a way to request APIs by using a custom query language, which has the advantage of providing a more flexible way to fetch data. Compared to RESTful APIs that require a single request for all the data needed, GraphQL allows the client to explicitly specify the data needed, thus reducing unnecessary data transfer and processing.\nHowever, GraphQL’s over-flexibility is also one of its drawbacks. Since it does not have some specifications for modeling business scenarios like the REST API, developers need to think about data processing themselves. developers need to think about how to handle the data themselves. This can lead to unreasonable query requests that can put excessive pressure on the back-end database. In addition, GraphQL has relatively few implementations and documentation, which also requires more learning costs.\nTherefore, while GraphQL can provide better results in some specific scenarios, it is not suitable for all API design needs. In fact, some companies have even chosen to drop support for GraphQL, such as Github’s some projects.\nLast Complexity is incremental\nJohn Ousterhout (via） There is no best style, only the best fit, but it is important to have style. ",
  "wordCount" : "6133",
  "inLanguage": "en",
  "datePublished": "2023-04-03T11:34:18+08:00",
  "dateModified": "2023-04-03T11:34:18+08:00",
  "author":{
    "@type": "Person",
    "name": "alswl"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://en.blog.alswl.com/2023/04/web-api-guidelines/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Log4D",
    "logo": {
      "@type": "ImageObject",
      "url": "https://en.blog.alswl.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://en.blog.alswl.com" accesskey="h" title="Log4D (Alt + H)">Log4D</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://blog.alswl.com/" title="中文博客">
                    <span>中文博客</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://en.blog.alswl.com/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://en.blog.alswl.com/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://en.blog.alswl.com/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://en.blog.alswl.com/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://en.blog.alswl.com">Home</a>&nbsp;»&nbsp;<a href="https://en.blog.alswl.com/posts/">Posts</a></div>
    <h1 class="post-title">
      Pragmatic web API guidlines
    </h1>
    <div class="post-meta"><span title='2023-04-03 11:34:18 +0800 +0800'>2023-04-03</span>&nbsp;·&nbsp;alswl

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#why-we-need-api-uniformity-specifications">Why We Need API Uniformity Specifications</a></li>
    <li><a href="#principles-of-rules">Principles of rules</a></li>
    <li><a href="#does-rest-work-or-not">Does REST work or not?</a></li>
    <li><a href="#web-api-specification-multiple-choice-questions">Web API specification multiple choice questions</a>
      <ul>
        <li><a href="#url-best-practices">URL Best Practices</a></li>
        <li><a href="#header-best-practices">Header Best Practices</a></li>
        <li><a href="#request-best-practices">Request Best Practices</a></li>
        <li><a href="#response-best-practices">Response Best Practices</a></li>
        <li><a href="#others">Others</a></li>
      </ul>
    </li>
    <li><a href="#a-style-checklist">A style Checklist</a>
      <ul>
        <li><a href="#github-style">Github style</a></li>
        <li><a href="#azure-style">Azure style</a></li>
        <li><a href="#my-personal-style">My personal style</a></li>
      </ul>
    </li>
    <li><a href="#off-topic---an-interesting-design-for-apple-music">Off-Topic - An Interesting Design for Apple Music</a></li>
    <li><a href="#off-topic---why-graphql-doesnt-work">Off-Topic - Why GraphQL Doesn&rsquo;t Work</a></li>
    <li><a href="#last">Last</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>When starting to create a new system, or participating in a new team or project, there is a simple but profound question: Is there a design specification for the API of this system (Web Server)?</p>
<p>




<img loading="lazy" src="/images/202304/pyramid.png" alt="pyramid"  />


</p>
<p><small>image by stable difussion, prompt by alswl</small></p>
<p>This issue has bothered me for a long time, starting during my school days, and every time I needed to communicate and discuss with my team members.
From the initial free style to the later REST, I often referenced <a href="https://docs.github.com/en/rest?apiVersion=2022-11-28">Github v3</a> to the project team and the
Foursqure API (no longer accessible, exposing age) documentation.
However, in practice, there are still cases where there is a mismatch with the actual work or the common company specification.
This is when I need to do some additional work. Eventually, I will write a brief <code>DEVELOPMENT.md</code> document to describe the design solution.</p>
<p>But I&rsquo;ve always had more ideas for that document, and it&rsquo;s not quite good enough. So, I wanted to put together a <mark>Simple and Pragmatic</mark> Web API best practice, which is this article.</p>
<h2 id="why-we-need-api-uniformity-specifications">Why We Need API Uniformity Specifications<a hidden class="anchor" aria-hidden="true" href="#why-we-need-api-uniformity-specifications">#</a></h2>
<p>The problem seems obvious, but a deeper analysis involves teamwork efficiency and engineering design philosophy.</p>
<p>API (Application Programming Interface) is the bridge between different software systems to interact with each other. When communicating between different software systems, the
APIs allow data transfer and processing in a standardized way, enabling the integration of various applications.</p>
<p>When we start writing API documentation, a paradigm (Design Pattern) emerges, whether it is explicit or implicit, whether
Whether it is one set for each or a common set. This is just like when we use a unified USB interface, unification reduces costs and avoids possible errors. Specifically, there are several reasons for this:</p>
<ul>
<li>Ease of understanding and efficiency: service providers and consumers use a unified form, structure and usage, and a unified production-consumption protocol, thus reducing communication costs.</li>
<li>Expert experience: It contains best engineering practices with corresponding solutions for common scenarios, avoiding the need for everyone to rethink the entire API system.
For example, how do you handle API caching? How to perform authentication? How to handle data formatting?</li>
<li>Extensibility: extensibility require stable protocols, protocols are abstract and implementation-independent, and not everyone has them
The ability to design uncertainty-oriented systems, and some widely used technologies plan for a wider range of scenarios.</li>
</ul>
<p>




<img loading="lazy" src="/images/202304/image-20230430225520666.png" alt="why"  />


</p>
<p><small>image by alswl</small></p>
<p>While it is true that there are some costs associated with the use of a unified specification that requires framework understanding and promotion, I believe that in most scenarios
the benefits of a unified specification far outweigh these costs.</p>
<p>However, not all cases require consideration of the API specification. For short lifecycle projects, internal projects and products with a very small impact
specifications may not require much attention. In addition, in some special business scenarios, the
The underlying protocol may change, and the existing specification may no longer be applicable. But even so, I still recommend redrafting a new specification, rather than abandoning it.</p>
<h2 id="principles-of-rules">Principles of rules<a hidden class="anchor" aria-hidden="true" href="#principles-of-rules">#</a></h2>
<p>When developing API specifications, we should follow some basic principles to deal with technical differences, and I have summarized three principles that have gained wide acceptance:</p>
<ul>
<li>Simplicity: Simplicity is the most direct and effective strategy to resist complexity, using the principle of simplicity to reduce complexity and avoid the breeding and proliferation of complexity;</li>
<li>Consistency: uniform design patterns and continuity of design styles help reduce engineering costs and the psychological burden on engineers;</li>
<li>follow reality: follow the abstractions and layering of existing engineering domains (e.g. HTTP, REST, RBAC, OIDC, etc.) and do not invent new concepts of your own.
Always think about whether the problem is the only one you have encountered (the answer is definitely no).</li>
</ul>
<p>




<img loading="lazy" src="/images/202304/image-20230430225710666.png" alt="principle"  />


</p>
<p><small>image by alswl</small></p>
<h2 id="does-rest-work-or-not">Does REST work or not?<a hidden class="anchor" aria-hidden="true" href="#does-rest-work-or-not">#</a></h2>
<p>The <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful API</a> has become a popular protocol in the Web API space.
Its broad applicability and reach stems from its binding to the HTTP protocol, which allows RESTful APIs to easily interact with existing Web technologies. If you are not familiar with REST, you can check out [Yifeng Ruan&rsquo;s
You can check out <a href="https://www.ruanyifeng.com/blog/2014/05/restful_api.html">Yifeng Ruan&rsquo;s RESTful API Design Guide</a> and
<a href="https://www.oschina.net/translate/best-practices-for-a-pragmatic-restful-api?print">Best Practices for RESTful API Design</a>.</p>
<p>REST is a high maturity protocol, which <a href="https://martinfowler.com/articles/richardsonMaturityModel.html#level0">Leonard Richardson</a>
describes it as having four levels of maturity:</p>
<p>




<img loading="lazy" src="/images/202304/rest-four-level.png" alt="rest-four-level"  />


</p>
<p><small>image by alswl</small></p>
<ol>
<li>The Swamp of POX, using HTTP to host the Legacy protocol (XML)</li>
<li>Resources: using resource abstraction</li>
<li>HTTP Verbs: using rich HTTP Verbs</li>
<li>Hypermedia Controls: API resource integration using <code>rel</code> links, <a href="https://jsonapi.org/">JSON:API</a> is the pinnacle of performance</li>
</ol>
<p>The core strength of REST is that</p>
<ul>
<li>It takes full advantage of the design of the HTTP Protocol (HTTP Protocol)</li>
<li>It has excellent identification of resources</li>
<li>It is designed with complete manipulation of resources (Manipulation of resources)</li>
<li>It has Self-descriptive messages</li>
<li>It supports multiple forms of presentation (hypermedia as the engine of application state)</li>
</ul>
<p>However, <mark>REST is not a specific protocol or specification, but a style philosophy</mark>. While REST defines rules and principles such as the identification of resources, unified interfaces, stateless communication, etc., it does not prescribe a specific protocol or specification.
it does not prescribe a specific way to implement them. As a result, in practice, different teams may have different understandings and practices, leading to inconsistencies and portability of the API.
This leads to inconsistency and reduced maintainability of the API.</p>
<p>In addition, REST has a number of limitations and drawbacks:</p>
<ul>
<li>Not all requests can be described by resources, such as the login (<code>/login</code>) operation, which is very convoluted when converted to <code>session</code>;
The same problem arises for operations like money transfers, where the limited number of HTTP verbs cannot support all business scenarios.</li>
<li>REST does not provide a clear solution to the inevitable problems such as paging, specific structure of the return body, error handling and authentication, etc.</li>
<li>For complex queries (such as Search Search), the query parameters of the RESTful API can become very complex and difficult to maintain.</li>
</ul>
<p>Therefore, although the REST style is a good guideline, the specific implementation needs to be combined with specific business requirements and technical features to make some trade-offs in order to achieve a good API design.
Finally, do we need a Web API design specification that follows the REST style? I think REST can solve 90% of the problems, but there is still 10% need to specify the details.</p>
<h2 id="web-api-specification-multiple-choice-questions">Web API specification multiple choice questions<a hidden class="anchor" aria-hidden="true" href="#web-api-specification-multiple-choice-questions">#</a></h2>
<p>Since our protocol is based on HTTP and REST design, we will base our discussion on the four core parts of an HTTP request: URL, Header, Request and Response.
These are: URL, Header, Request and Response.</p>
<h3 id="url-best-practices">URL Best Practices<a hidden class="anchor" aria-hidden="true" href="#url-best-practices">#</a></h3>
<p>My inspiration for URL design came from <a href="https://guides.rubyonrails.org/routing.html">Ruby on Rails</a>.
Before that, I always instinctively put model information on top of URLs, but in reality good URL design should be a plan for the information structure of the system.
Therefore, URL design should consider not only the API, but also the user-oriented Web URL.</p>
<p>To achieve good URL design, I have summarized the following rules:</p>
<ul>
<li>Locate resources (this answers the question of whether paging should be in the Header)</li>
<li>Self-explanatory (readable, the URL itself contains the core information)</li>
<li>Security (can not contain user authentication information, OAuth spent a lot of effort to understand this, anti-forgery)</li>
</ul>
<p>Typically, the URL model is as follows:</p>
<p><code>/$(prefix)/$(module)/$(model)/$(sub-model)/$(verb)?$(query)#${fragment}</code></p>
<p>where Prefix may be the version of the API, or it may be a special qualification, as some companies rely on for access layer triage;
Module is a business module, which can also be omitted; Model is a model; SubModel is a submodel, which can be omitted;
Verb is a verb, which can also be omitted; Query is a request parameter; Fragment is an HTTP primitive Fragment.</p>
<p>It is important to note that not all components are required to appear. For example, fields such as SubModel and Verb can
be allowed to be hidden in different URL styles.</p>
<p><strong>Design Style Options</strong></p>
<p>Note: <strong>Please note that there is no association between Scenario A / B / C and no association above or below each line</strong></p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Explanation (see separate analysis below)</th>
<th>Option A</th>
<th>Option B</th>
<th>Option C</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dos API path&rsquo;s prefix</td>
<td></td>
<td><code>/apis</code></td>
<td><code>/api</code></td>
<td>second-level domain</td>
</tr>
<tr>
<td>Does the path contain the API version</td>
<td><strong>Version advantage in URLs</strong></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Does path contain a group</td>
<td></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Whether path contains action</td>
<td><strong>HTTP Verb is not enough</strong></td>
<td>✅</td>
<td>🚫 (pure REST)</td>
<td>Depends (include if HTTP Verb CRUD cannot be satisfied)</td>
</tr>
<tr>
<td>Model ID form</td>
<td><strong>Readable Stable Identity explained</strong></td>
<td>Self-incrementing ID</td>
<td>GUID</td>
<td><mark>Readable Stable ID</mark></td>
</tr>
<tr>
<td>Model singular or plural in URL</td>
<td></td>
<td>Singular</td>
<td>Plural</td>
<td>List Plural, One-Way Singular</td>
</tr>
<tr>
<td>Is the resource one-level (tiled) or multi-level (nested)</td>
<td><strong>Explanation of one-level and multi-level</strong></td>
<td>One-level (tiled)</td>
<td>Multi-level (nested)</td>
<td></td>
</tr>
<tr>
<td>How is search implemented, standalone API (<code>/models/search</code>) or list-based <code>/models/</code> API</td>
<td></td>
<td>standalone</td>
<td>list-based</td>
<td></td>
</tr>
<tr>
<td>Does it have an Alias URL</td>
<td><strong>Alias URL explanation</strong></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Does the model in the URL allow abbreviations (or refinements)</td>
<td><strong>Model abbreviations explained</strong></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Hyphenation of multiple words of the model in the URL</td>
<td></td>
<td><code>-</code></td>
<td><code>_</code></td>
<td>Camel</td>
</tr>
<tr>
<td>Whether to distinguish between Web API and Open API (non-browser oriented)</td>
<td></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Version advantage in URLs</strong></p>
<p>We follow the principle of consistency when designing URLs; the same URL is used to access the same resource, regardless of identity or state.
This is also the basic principle of Uniform Resource Location. While we can accept different content formats (e.g. JSON / YAML / HTML / PDF / etc.)
but we want the location of the resource to be unique.</p>
<p>However, the question is, should the same resource be reflected in the URL for rendering between versions? This depends on whether the designer considers versioning to be in the realm of location information.</p>
<p>According to the RFC design, in addition to the URL there is <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Name">URN (Uniform Resource Name)</a>.
The latter is used to identify the resource, while the URL points to the resource address. In practice, URNs are not so widely used that URIs are almost equivalent to URLs.</p>
<p><strong>HTTP Verb is not enough</strong></p>
<p>In REST design, we need to operate on resources using HTTP verbs like GET / POST / PUT / DELETE / PATCH / HEAD.
For example, using the API <code>GET /apis/books</code> to view book listings is natural and reasonable.
However, when it comes to performing an action like &ldquo;borrow a book
we don&rsquo;t have a suitable verb (BORROW) to represent it. In this case, there are two possible options:</p>
<ol>
<li>use the POST method with a custom verb, such as <code>POST /apis/books/borrow</code>, for the action of borrowing a book;</li>
<li>creating a book borrow log, using a resource add method to structure the non-existent action, e.g. <code>POST /apis/books/borrow-log/</code>;</li>
</ol>
<p>This issue comes up a lot in complex scenarios such as user login (<code>POST /api/auth/login</code> vs <code>POST /api/session</code>) and account transfers (vs transfer record creation), etc.
<mark>API abstract or concrete, there is always an explanation of the business. </mark> We can&rsquo;t simply generalize all of our business to CRUD.
Rather, we need to divide the business wisely to make it clearer and more understandable to users.</p>
<p>When designing, we can consider whether we need to create a corresponding button for each API to make it easier for users to do so.
If there is only one API named <code>/api/do</code> and all the services are bound to it, although technically possible, this design does not meet the business requirements.
Each layer of abstraction is designed to standardize the solution to a particular problem, and the TCP L7 design is a reflection of this philosophy.</p>
<p><strong>Readable Stable Identity explained</strong></p>
<p>When marking a resource, we typically have several options:</p>
<ul>
<li>Use ID: IDs are usually bound to database self-incrementing IDs.</li>
<li>Use a GUID: such as a UUID, although less precise.</li>
<li>Use Readable Stable Identity: Usually identified by name, UID, or a specific ID such as a host name, IP address, or serial number.
This identifier is required to be stable and globally unique, which is useful in internal systems.</li>
</ul>
<p>I have a personal design tip: use a slug of the form <code>${type}/${type-id}</code> to describe an identifier.
For example <code>hostname/abc.sqa</code> or <code>ip/172.133.2.1</code>.
This design approach provides a good balance between readability and uniqueness.</p>
<blockquote>
<p>A slug is a human-readable, unique identifier, used to identify a resource instead of a less human-readable identifier like an id .</p>
</blockquote>
<p>from <a href="https://itnext.io/whats-a-slug-f7e74b6c23e0">What&rsquo;s a slug. and why would I use one? | by Dave Sag</a></p>
<p>PS: At the end of the article I&rsquo;ll also introduce an Apple Music solution that combines the ID / Readable / Stable features.</p>
<p><strong>Explanation of one-level and multi-level</strong></p>
<p>The hierarchical design of URLs can be based on modeling, or a straightforward single-level structure can be used. specific problem solving approach.
For example, when designing user-owned books, one can choose a multi-level structure <code>/api/users/foo/books</code> or a one-level structure <code>/api/books?owner=foo</code>.</p>
<p>Both options are technically possible, <mark>the former respecting the attribution of the model, and the latter focusing on the simplicity of the URL structure</mark>.</p>
<p>A multi-level structure is more intuitive, but also needs to address the issue of possible multiple ways of organization, such as books in a library organized by author or category?
In this case, consider making the attribution of models explicit in a multi-level structure
For example <code>/api/author/foo/books</code> (based on authors) or <code>/api/category/computer/books</code> (based on categories).</p>
<p><strong>Alias URL explanation</strong></p>
<p>For some frequently used URLs, although they can be designed according to URL rules, we can still design a more concise URL that
to facilitate user presentation and use. This design is especially common for Web URLs. For example, the API for a library&rsquo;s most popular books:</p>
<pre tabindex="0"><code># Original URL
https://test.com/apis/v3/books?sort=hot&amp;limit=10

# Alias URL
https://test.com/apis/v3/books/hot
</code></pre><p><strong>Model abbreviations explained</strong></p>
<p>Often, when modeling resources, longer names are used to name them, for example a book index might be named <code>BookIndex</code> instead of <code>Index</code>.
When rendering in URLs, since the URL prefix of <code>/book/book-index</code> contains Book, we can reduce the layer of description and
We can make the URL more concise, for example by using <code>/book/index</code>. This technique is very common in Web URL design.</p>
<p>There is also a strategy of model abbreviation, which provides a complete set of alias registration schemes. aliases that are globally unique.
For example, in Kubernetes, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#deployment-v1-apps">Deployment</a>
is a common naming, while <code>apps/v1/Deployment</code> is the full name by adding a Group restriction.
There is also a shorthand for <code>deploy</code>. This mechanism relies on Kubernetes&rsquo; API Schema system for registration and work.</p>
<h3 id="header-best-practices">Header Best Practices<a hidden class="anchor" aria-hidden="true" href="#header-best-practices">#</a></h3>
<p>We often overlook the importance of the Header. In fact, the selection of HTTP verbs, HTTP status codes, and various authentication logic (e.g., cookies / Basic Auth / Berear Token) all depend on the design of the Header.
In fact, the selection of HTTP verbs, HTTP status codes, and various identity verification logic (e.g., Cookie / Basic Auth / Berear Token) all depend on the design of the Header.</p>
<p><strong>Design style selection</strong></p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Explanation (see separate analysis below)</th>
<th>Option A</th>
<th>Option B</th>
<th>Option C</th>
</tr>
</thead>
<tbody>
<tr>
<td>Are all verbs using POST</td>
<td><strong>About only using POST</strong></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Is the Modify action POST or PATCH?</td>
<td></td>
<td>POST</td>
<td>PATCH</td>
<td></td>
</tr>
<tr>
<td>HTTP status return code</td>
<td><strong>2XX family</strong></td>
<td>Make full use of HTTP Status</td>
<td>Use only core status (200 404 302, etc.)</td>
<td>Use only 200</td>
</tr>
<tr>
<td>Is using rate limiter system</td>
<td></td>
<td>✅ 429</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Is using cache system</td>
<td></td>
<td>✅  ETag / Last Modify</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Is validate UserAgent</td>
<td></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
<tr>
<td>Is validate  Referrral</td>
<td></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>About only using POST</strong></p>
<p>Some novices (or those who consider themselves experienced) may come to the erroneous conclusion that, with the exception of GET requests
all HTTP requests should use the POST method. Some even demand that <a href="https://www.zhihu.com/question/336797348">all actions (even read-only requests) should use the POST method</a>.
This argument is often supported on the grounds of &ldquo;simple consistency&rdquo;, &ldquo;cache avoidance&rdquo;, or &ldquo;operator requirements&rdquo;.</p>
<p>However, it is important to understand the original design of the HTTP method: it is used to describe the type of resource manipulation that gives rise to a number of issues including caching, security, and idempotency.
In relatively simple scenarios, omitting this layer of abstraction really doesn&rsquo;t pose much of a problem, but once you get into the complexities of the domain, the
Using this layer of abstraction for HTTP methods becomes very important. <mark>Whether this follows the standard or not will determine whether you get the benefits of standardization</mark>.
The analogy is like a new phone manufacturer that can choose not to use the USB TypeC interface.
It&rsquo;s technically possible, but it also loses a lot of standardization support and mental agreement.</p>
<p>I especially like one <a href="https://www.zhihu.com/people/huixiong-19">Knowing user</a>&rsquo;s
<a href="https://www.zhihu.com/question/336797348/answer/2198634068">comment</a>: &ldquo;<mark>Routing hasn&rsquo;t gone away, it&rsquo;s just shifted</mark>.</p>
<p><strong>2XX family</strong></p>
<p>The purpose of HTTP status codes is to indicate the result of communication between the client and the server. 2XX status code family means that the server has successfully received, understood, and processed the client request,
understood and processed the client request, and the response was successful. The following are common status codes in the 2XX family and their meanings:</p>
<ul>
<li>200 OK: The request was processed successfully and the server returned a response.</li>
<li>201 Created: The request has been successfully processed and a new resource has been created on the server.</li>
<li>202 Accepted: The request has been accepted by the server, but not yet executed. This status code is typically used for asynchronous processing.</li>
<li>204 No Content: The request was processed successfully, but the server did not return any response body content.</li>
</ul>
<p>The 2XX family of status codes indicates that the request has been successfully processed. These status codes let the client know explicitly that the request has been processed correctly so that it can proceed to the next step.</p>
<p>The need to use the 2XX family of status codes across the board depends on whether the client needs to be explicitly/displayed with information that
inform it of the next action. If it has been clearly described by other means (including documentation, verbal agreements)
then it is indeed possible to use 200 status codes across the board for return. But passing meaning based on behavior.
or document-based (or even verbal)? Is it more complex or more concise?</p>
<h3 id="request-best-practices">Request Best Practices<a hidden class="anchor" aria-hidden="true" href="#request-best-practices">#</a></h3>
<p><strong>Design style selection</strong></p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Explanation (see separate analysis below)</th>
<th>Option A</th>
<th>Option B</th>
<th>Option C</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Whether complex parameters are put into Form Fields or a separate JSON Body</td>
<td></td>
<td>Form Fields</td>
<td>Body</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Whether the subresource is a one-time query or an independent query</td>
<td></td>
<td>one-time</td>
<td>independent</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Paging parameter storage</td>
<td></td>
<td>Header</td>
<td>URL Query</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Paging parameter method</td>
<td><strong>Explanation of paging method</strong></td>
<td>Page based</td>
<td>Offset based</td>
<td>Continuation token</td>
<td></td>
</tr>
<tr>
<td>Paging Controllers</td>
<td><strong>Paging controller explanation</strong></td>
<td>Client</td>
<td>Server</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Explanation of paging methods</strong></p>
<p>The two most common types of paging we see are Page-based and Offset-based, which can be mapped by formula.
In addition, there exists a method called Continuation Token, which is similar in technique to Oracle&rsquo;s
<a href="https://stackoverflow.com/questions/241622/paging-with-oracle">rownum paging scheme</a>, using the parameter <code>start-from=? </code> to describe it.
While the advantages and disadvantages of Continuation Token are significant, using this approach allows sequential to be used as an alternative to random.</p>
<p><strong>Paging controls interpretation</strong>.</p>
<p>In some cases, we need to distinguish between Client Pagination and Server Pagniation.
Client Pagination means that the parameters of the next page are calculated by the client, while Server Pagination is a protocol such as <code>rel</code> or JSON.API returned by the server.
Using Server Pagniation avoids some problems, such as bulk blocking of some content, which may result in missing pages or white screens if client-side paging is used.</p>
<h3 id="response-best-practices">Response Best Practices<a hidden class="anchor" aria-hidden="true" href="#response-best-practices">#</a></h3>
<p><strong>Design Style Selection</strong></p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Explanation (see separate analysis below)</th>
<th>Option A</th>
<th>Option B</th>
<th>Option C</th>
</tr>
</thead>
<tbody>
<tr>
<td>Model presentation types</td>
<td><strong>Several forms of models</strong></td>
<td>Single model</td>
<td>Multiple models</td>
<td></td>
</tr>
<tr>
<td>How large models contain sub-model models</td>
<td><strong>Linking, sidecar, and embedding of models</strong></td>
<td>Embedding</td>
<td>Core model + multiple linked resource queries</td>
<td>Linking</td>
</tr>
<tr>
<td>Whether field returns are on-demand or grouped or unified</td>
<td></td>
<td>unified</td>
<td>Use the <code>fields</code> field on demand</td>
<td></td>
</tr>
<tr>
<td>field presentation format</td>
<td></td>
<td>Snake</td>
<td>Camel</td>
<td></td>
</tr>
<tr>
<td>Error code</td>
<td></td>
<td>No customization, use Message</td>
<td>Custom</td>
<td></td>
</tr>
<tr>
<td>Error format</td>
<td></td>
<td>global uniform</td>
<td>on-demand</td>
<td></td>
</tr>
<tr>
<td>Time Zone</td>
<td></td>
<td>UTC</td>
<td>Local</td>
<td>Local + TZ</td>
</tr>
<tr>
<td>HATEOAS</td>
<td></td>
<td>✅</td>
<td>🚫</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Several forms of models</strong></p>
<p>In API design, there are several definitions for how models should be represented. Although this is not a topic that must be discussed in the API specification, it is very important for API design.</p>
<p>I have divided the model presentation that models are often described into the following categories, which are not professionally defined and borrow some definitions from the Java context below.
These names will be called differently in different companies and even different teams:</p>
<p>




<img loading="lazy" src="/images/202304/models.png" alt="models"  />


</p>
<p><small>image by alswl</small></p>
<ul>
<li>Business Object (BO): the original business model</li>
<li>Data Object (DO): the model stored to the RDBMS, so it must be a flat field structure, sometimes a BO will correspond to multiple DOs</li>
<li>View Object (VO): the model presented to the presentation layer, only keep the information the user needs to see, such as sensitive information will be removed</li>
<li>Data Transfer Object (DTO): the model used to transfer in the RPC system, generally not much different from the original Model, depending on the different serialization systems will have differences
(such as the handling of enumerations)</li>
</ul>
<p>In addition, two other categories are often used: Rich Model and Tiny Model (please ignore the naming, it varies a lot from team to team):</p>
<ul>
<li>Rich Model: This model is used to describe a rich model, which contains almost all the data needed and allows nesting of sub-resources.</li>
<li>Tiny Model: is a compact model, often used in the list API to be used</li>
</ul>
<p><strong>Linking, sidecar, and embedding of models</strong></p>
<p>In API design, we often need to deal with cases where a model contains multiple submodels, such as a Book containing Comments.
For this case, there are usually three representations to choose from: Link, Side, and Embed.</p>
<p>




<img loading="lazy" src="/images/202304/models-with-children.png" alt="models-with-children"  />


</p>
<p><small>image by alswl</small></p>
<p>Linking (sometimes this URL is also hidden, based on an implicit protocol between client and server for requests):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;朝花夕拾&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;relationships&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;comments&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.domain.com/book/42/comments&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;http://www.domain.com/author/鲁迅&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Sidecar:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;朝花夕拾&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;relationships&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;comments&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.domain.com/book/42/comments&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;authors&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;http://www.domain.com/author/鲁迅&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;includes&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;comments&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;匿名&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;非常棒&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;authors&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;鲁迅&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;鲁迅原名周树人&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Embedding:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;朝花夕拾&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;comments&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;匿名&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;非常棒&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;authors&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;鲁迅&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;鲁迅原名周树人&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="others">Others<a hidden class="anchor" aria-hidden="true" href="#others">#</a></h3>
<p>There are some other issues that are not converged in the four elements, but we often encounter them in engineering practice, and I will run them out:</p>
<p>**I&rsquo;m not in the HTTP protocol, what should I do? ** I&rsquo;m not in the HTTP protocol, what should I do?</p>
<p>Non-HTTP protocols are less commonly encountered in Web APIs, and the cost of creating a new set of protocols is too high. There are protocols that are introduced in certain areas.
For example, <a href="https://mqtt.org/">MQTT</a> in the IoT domain.</p>
<p>In addition, RPC is a wide-ranging concept that goes far beyond the protocol level.
Often we compare the transport protocols of HTTP and RPC, as well as serialization protocols.
I believe that much of the discussion in this paper is also of importance to the RPC community.</p>
<p>Some teams or individuals plan to use protocols that they create themselves, but my opinion is that self-built protocols should be avoided as much as possible, because it is very rare that there is a real need to create a protocol.
If a strong need does exist, then I would ask two questions: Have you read through the HTTP RFC document and the HTTP/2 RFC document?</p>
<p>**I&rsquo;m not a remote service (RPC / HTTP etc.), but what about the SDK? ** This article focuses on Web APIs (RPC/ HTTP etc.).</p>
<p>This article focuses on the design specifications of the Web API (HTTP) and some of the rules can be applied to RPC systems.
However, the basis of the discussion is based on Remote Service.
If you are an SDK developer, you will have two roles, possibly as a client communicating with a remote server, and as an SDK providing developer-oriented services.
You will also provide developer-facing interfaces as an SDK. For the latter, the following specifications can be used as a reference:</p>
<p>For the latter, you can refer to these specifications:</p>
<ul>
<li>Azure SDK Design Specifications <a href="https://azure.github.io/azure-sdk/general_design.html">General Guidelines: API Design | Azure SDKs</a></li>
<li>Posix API examples (e.g. File <a href="https://www.gnu.org/software/libc/manual/html_node/Low_002dLevel-I_002fO.html">Low-Level I/O (The GNU C Library)</a>)</li>
</ul>
<p><strong>Authentication Authentication Scheme</strong></p>
<p>In general, the Web API design will clearly describe the authentication and authentication system to be used.
It is important to distinguish between the concepts of &ldquo;authentication&rdquo; and &ldquo;authentication&rdquo;. The topic of &ldquo;authentication&rdquo; can be discussed in a separate section, so this paper will not cover this aspect.</p>
<p>In Web API design, common authentication methods include HTTP Basic Auth, OAuth2, and account password login.
In addition, HMac algorithm-based anti-replay and anti-tampering schemes are used for anti-tampering.</p>
<p><strong>Overlooked Topics</strong></p>
<p>In this discussion, I did not cover the following topics: asynchronous protocols (Web Sockets / Long Pulling / Round Trials), CORS, and security issues.
Although these topics are important, they will not be covered in this article.</p>
<p><strong>When to break the rules</strong></p>
<p>Some developers believe that rules are there to be broken. The reality is often so complex that it is difficult to discuss the details.
If a developer feels that a rule does not meet the actual need, there are two ways to handle it: change the rule or break it.
However, I prefer to discuss and update the rules, clarify where the specification is inadequate, and determine if there are special cases.
If a special case does need to be created, be sure to describe it in detail in the documentation, informing the successor and the consumer that it is a special case, explaining why the special case was created and how the special case responds.</p>
<h2 id="a-style-checklist">A style Checklist<a hidden class="anchor" aria-hidden="true" href="#a-style-checklist">#</a></h2>
<h3 id="github-style">Github style<a hidden class="anchor" aria-hidden="true" href="#github-style">#</a></h3>
<p>Github&rsquo;s API is one that I often refer to. It models its business domain very clearly, provides thorough documentation, and makes communication much less costly.
I mainly refer to the following two links:
API Definition <a href="https://docs.github.com/en/rest?apiVersion=2022-11-28">GitHub REST API documentation</a> and
a list of application-oriented APIs [Endpoints available for GitHub Apps](<a href="https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps">https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps</a>? apiVersion=2022-11-28)
This list includes almost all of Github&rsquo;s APIs.</p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Choice</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>URL</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Dos API path&rsquo;s prefix</td>
<td>second-level domain</td>
<td><a href="https://api.github.com">https://api.github.com</a></td>
</tr>
<tr>
<td>Does the path contain the API version</td>
<td>🚫</td>
<td>Header <code>X-GitHub-Api-Version</code> <a href="https://docs.github.com/en/rest/overview/api-versions?apiVersion=2022-11-28">API Versions</a></td>
</tr>
<tr>
<td>Does path contain a group</td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td>Whether path contains action</td>
<td>Depends (include if HTTP Verb CRUD cannot be satisfied)</td>
<td>sample: /repos/{owner}/{repo}/pulls/{pull_number}/merge POST /repos/{owner}/{repo}/releases/generate-notes</td>
</tr>
<tr>
<td>Model ID form</td>
<td>Readable Stable Identity</td>
<td> </td>
</tr>
<tr>
<td>Model singular or plural in URL</td>
<td>Plural</td>
<td> </td>
</tr>
<tr>
<td>Is the resource one-level (tiled) or multi-level (nested)</td>
<td>multi-level</td>
<td> </td>
</tr>
<tr>
<td>How is search implemented, standalone API (/models/search) or list-based /models/ API</td>
<td>standalone</td>
<td> </td>
</tr>
<tr>
<td>Does it have an Alias URL</td>
<td>?</td>
<td> </td>
</tr>
<tr>
<td>Does the model in the URL allow abbreviations (or refinements)</td>
<td>🚫</td>
<td>No obvious information is seen, and it is not required based on the multilevel model, but it exists GET /orgs/{org}/actions/required_workflows</td>
</tr>
<tr>
<td>Hyphenation of multiple words of the model in the URL</td>
<td>- and _</td>
<td>GET /repos/{owner}/{repo}/git/matching-refs/{ref} vs GET /orgs/{org}/actions/required_workflows</td>
</tr>
<tr>
<td>Whether to distinguish between Web API and Open API (non-browser oriented)</td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td><strong>Header</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Are all verbs using POST           </td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td>Is the Modify action POST or PATCH?</td>
<td>PATCH</td>
<td> </td>
</tr>
<tr>
<td>HTTP status return code            </td>
<td>Leverage HTTP Status</td>
<td>Commonly used, including rate limiter</td>
</tr>
<tr>
<td>Is using rate limiter system       </td>
<td>✅ 429</td>
<td> </td>
</tr>
<tr>
<td>Is using cache system              </td>
<td>✅ ETag / Last Modify</td>
<td><a href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api?apiVersion=2022-11-28#client-errors">Resources in the REST API#client-errors</a></td>
</tr>
<tr>
<td>Is validate UserAgent              </td>
<td>✅</td>
<td> </td>
</tr>
<tr>
<td>Is validate  Referrral             </td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td><strong>Request</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Whether complex parameters are put into Form Fields or a separate JSON Body</td>
<td>Body</td>
<td>for example, <a href="https://docs.github.com/en/rest/pulls/pulls?apiVersion=2022-11-28#create-a-pull-request">Pulls#create-a-pull-request</a></td>
</tr>
<tr>
<td>Whether the subresource is a one-time query or an independent query        </td>
<td>one-time</td>
<td>Judging from Pulls</td>
</tr>
<tr>
<td>Paging parameter storage                                                   </td>
<td>URL Query</td>
<td> </td>
</tr>
<tr>
<td>Whether complex parameters are put into Form Fields or a separate JSON Body</td>
<td>Page</td>
<td><a href="https://docs.github.com/en/rest/guides/using-pagination-in-the-rest-api?apiVersion=2022-11-28">Using pagination in the REST API</a></td>
</tr>
<tr>
<td>Whether the subresource is a one-time query or an independent query        </td>
<td>Server</td>
<td><a href="https://docs.github.com/en/rest/guides/using-pagination-in-the-rest-api?apiVersion=2022-11-28">Using pagination in the REST API</a></td>
</tr>
<tr>
<td><strong>Response</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Model presentation types                                 </td>
<td>Multi</td>
<td>For example, the details in Commits and Parent <a href="https://docs.github.com/en/rest/commits/commits?apiVersion=2022-11-28">Commits</a></td>
</tr>
<tr>
<td>How large models contain sub-model models                </td>
<td>Core Model + Multiple Linked Resource Queries</td>
<td>Not explicitly stated, inferred from several core APIs</td>
</tr>
<tr>
<td>Whether field returns are on-demand or grouped or unified</td>
<td>Unified</td>
<td> </td>
</tr>
<tr>
<td>field presentation format                                </td>
<td>Snake</td>
<td> </td>
</tr>
<tr>
<td>Error code                                               </td>
<td>None</td>
<td><a href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api?apiVersion=2022-11-28#client-errors">Resources in the REST API#client-errors</a></td>
</tr>
<tr>
<td>Error format                                             </td>
<td>Global Harmonization</td>
<td><a href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api?apiVersion=2022-11-28#client-errors">Resources in the REST API#client-errors</a></td>
</tr>
<tr>
<td>Time Zone                                                </td>
<td>Multi（ISO 8601 &gt; Time-Zone Header &gt; User Last &gt; UTC）</td>
<td><a href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api?apiVersion=2022-11-28#timezones">Resources in the REST API#Timezones</a></td>
</tr>
</tbody>
</table>
<h3 id="azure-style">Azure style<a hidden class="anchor" aria-hidden="true" href="#azure-style">#</a></h3>
<p>Azure&rsquo;s API design follows [api-guidelines/Guidelines.md at master - microsoft/api-guidelines](<a href="https://github.com/Microsoft/api-guidelines/blob/">https://github.com/Microsoft/api-guidelines/blob/</a> master/Guidelines.md).
This article is schematic, and there is also a practical guide at [Best practices in cloud applications](<a href="https://learn.microsoft.com/en-us/azure/architecture/best-practices/index">https://learn.microsoft.com/en-us/azure/architecture/best-practices/index</a> -best-practices)
and <a href="https://learn.microsoft.com/en-us/azure/architecture/best-practices/api-design">Web API design best practices</a>.</p>
<p>Note that Azure&rsquo;s product line is much richer than Github, and some APIs do not follow Azure&rsquo;s own specifications.
When looking for examples, I mainly refer to
<a href="https://learn.microsoft.com/en-us/rest/api/?view=Azure">REST API Browser</a>, the
<a href="https://learn.microsoft.com/en-us/rest/api/storageservices/">Azure Storage REST API Reference</a>.
If the specific implementation conflicts with the Guidelines.md, I will use the Guidelines.md conclusion.</p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Choice</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>URL</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Dos API path&rsquo;s prefix</td>
<td>Second level domain</td>
<td> </td>
</tr>
<tr>
<td>Does the path contain the API version</td>
<td>🚫</td>
<td>x-ms-version</td>
</tr>
<tr>
<td>Does path contain a group</td>
<td>✅</td>
<td> </td>
</tr>
<tr>
<td>Whether path contains action</td>
<td>🚫？</td>
<td>Not explicitly stated, but there is a tendency to use the comp parameter for actions that keep the URL RESTful Reference Lease Container (REST API) - Azure Storage</td>
</tr>
<tr>
<td>Model ID form</td>
<td>Readable Stable Identity</td>
<td><a href="https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md#73-canonical-identifier">Guidelines.md#73-canonical-identifier</a></td>
</tr>
<tr>
<td>Model singular or plural in URL</td>
<td>Plural</td>
<td><a href="https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md#93-collection-url-patterns">Guidelines.md#93-collection-url-patterns</a></td>
</tr>
<tr>
<td>Is the resource one-level (tiled) or multi-level (nested)</td>
<td>one-level (tiled) / multi-level (nested)</td>
<td><a href="https://learn.microsoft.com/en-us/azure/architecture/best-practices/api-design#define-api-operations-in-terms-of-http-methods">api-design#define-api-operations-in-terms-of-http-methods</a>, note MS has comp=? parameter, which is used to handle special commands</td>
</tr>
<tr>
<td>How is search implemented, standalone API (/models/search) or list-based /models/ API</td>
<td>?</td>
<td>Tends to be list-based because of the heavy use of comp= this URL Param for subcommands such as <a href="https://learn.microsoft.com/en-us/rest/api/storageservices/incremental-copy-blob">Incremental Copy Blob (REST API) - Azure Storage</a></td>
</tr>
<tr>
<td>Does it have an Alias URL</td>
<td>?</td>
<td> </td>
</tr>
<tr>
<td>Does the model in the URL allow abbreviations (or refinements)</td>
<td>?</td>
<td> </td>
</tr>
<tr>
<td>Hyphenation of multiple words of the model in the URL</td>
<td>Camel</td>
<td><a href="https://learn.microsoft.com/en-us/rest/api/storagemover/job-runs/list?tabs=HTTP">Job Runs - List - REST API (Azure Storage Mover)</a></td>
</tr>
<tr>
<td>Whether to distinguish between Web API and Open API (non-browser oriented)</td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td><strong>Header</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Are all verbs using POST           </td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td>Is the Modify action POST or PATCH?</td>
<td>PATCH</td>
<td><a href="https://learn.microsoft.com/en-us/rest/api/storagemover/agents/update?tabs=HTTP">Agents - Update - REST API (Azure Storage Mover)</a></td>
</tr>
<tr>
<td>HTTP status return code            </td>
<td>Leverage HTTP Status</td>
<td><a href="https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md#711-http-status-codes">Guidelines.md#711-http-status-codes</a></td>
</tr>
<tr>
<td>Is using rate limiter system       </td>
<td>?</td>
<td> </td>
</tr>
<tr>
<td>Is using cache system              </td>
<td>✅</td>
<td><a href="https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md#75-standard-request-headers">Guidelines.md#75-standard-request-headers</a></td>
</tr>
<tr>
<td>Is validate UserAgent              </td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td>Is validate  Referrral             </td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td><strong>Request</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Whether complex parameters are put into Form Fields or a separate JSON Body</td>
<td>Body</td>
<td>Reference Agents - Create Or Update - REST API (Azure Storage Mover)</td>
</tr>
<tr>
<td>Whether the subresource is a one-time query or an independent query        </td>
<td>?</td>
<td> </td>
</tr>
<tr>
<td>Paging parameter storage                                                   </td>
<td>?</td>
<td>No conclusion</td>
</tr>
<tr>
<td>Whether complex parameters are put into Form Fields or a separate JSON Body</td>
<td>Page based</td>
<td> </td>
</tr>
<tr>
<td>Whether the subresource is a one-time query or an independent query        </td>
<td>Server</td>
<td><a href="https://learn.microsoft.com/en-us/rest/api/storagemover/agents/create-or-update?tabs=HTTP">Agents - Create Or Update - REST API (Azure Storage Mover)</a></td>
</tr>
<tr>
<td><strong>Response</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Model presentation types                                 </td>
<td>Sginle</td>
<td>Speculation</td>
</tr>
<tr>
<td>How large models contain sub-model models                </td>
<td>?</td>
<td>Overly complex scenarios with no single conclusion</td>
</tr>
<tr>
<td>Whether field returns are on-demand or grouped or unified</td>
<td>?</td>
<td> </td>
</tr>
<tr>
<td>field presentation format                                </td>
<td>Camel</td>
<td> </td>
</tr>
<tr>
<td>Error code                                               </td>
<td>Use the list of custom error codes</td>
<td>At least within their respective products</td>
</tr>
<tr>
<td>Error format                                             </td>
<td>Customization</td>
<td> </td>
</tr>
<tr>
<td>Time Zone                                                </td>
<td>?</td>
<td> </td>
</tr>
<tr>
<td>HATEOAS</td>
<td>?</td>
<td><a href="https://learn.microsoft.com/en-us/azure/architecture/best-practices/api-design#use-hateoas-to-enable-navigation-to-related-resources">api-design#use-hateoas-to-enable-navigation-to-related-resources</a></td>
</tr>
</tbody>
</table>
<p>The overall design style of Azure is more complex than the Github API, and there are multiple versions of the same product, making it a little less uniform.
It looks a little less uniform. It is also more difficult to have a single specification that binds all teams in this complex scenario.
We can see that the Azaure team is working on the Guidelines, and they are recently launching the vNext specification.</p>
<h3 id="my-personal-style">My personal style<a hidden class="anchor" aria-hidden="true" href="#my-personal-style">#</a></h3>
<p>My personal style is basically inherited from the Github API style, with some minor adjustments to make it more suitable for small and medium-sized product development.
The reasons for my changes are explained in the notes, and the starting point for changes is: simplify / reduce ambiguity / consider the actual cost. If &ldquo;Note&rdquo; is marked in the notes, it follows the Github scheme and adds some ideas.</p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Choice</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>URL</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Dos API path&rsquo;s prefix</td>
<td>/apis</td>
<td>We often have only one system, one domain name to host the API and Web Page</td>
</tr>
<tr>
<td>Does the path contain the API version</td>
<td>✅</td>
<td> </td>
</tr>
<tr>
<td>Does path contain a group</td>
<td>✅</td>
<td>Do a layer of business module split to isolate certain cooperation boundaries</td>
</tr>
<tr>
<td>Whether path contains action</td>
<td>Depends (include if HTTP Verb CRUD cannot be satisfied)</td>
<td> </td>
</tr>
<tr>
<td>Model ID form</td>
<td>Readable Stable Identity</td>
<td> </td>
</tr>
<tr>
<td>Model singular or plural in URL</td>
<td>Plural</td>
<td> </td>
</tr>
<tr>
<td>Is the resource one-level (tiled) or multi-level (nested)</td>
<td>Multi-level + One-level</td>
<td>Note: 80% of cases follow the model attribution, a few cases (commonly in search) use the first level</td>
</tr>
<tr>
<td>How is search implemented, standalone API (/models/search) or list-based /models/ API</td>
<td>Uniform &gt; Standalone</td>
<td>Low-cost implementation of some (early Github issues were also without /search interface)</td>
</tr>
<tr>
<td>Does it have an Alias URL</td>
<td>🚫</td>
<td>Keep it simple.</td>
</tr>
<tr>
<td>Does the model in the URL allow abbreviations (or refinements)</td>
<td>✅</td>
<td>Once the streamlining is done, it needs to be marked in the glossary</td>
</tr>
<tr>
<td>Hyphenation of multiple words of the model in the URL</td>
<td>-</td>
<td> </td>
</tr>
<tr>
<td>Whether to distinguish between Web API and Open API (non-browser oriented)</td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td><strong>Header</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Are all verbs using POST           </td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td>Is the Modify action POST or PATCH?</td>
<td>PATCH</td>
<td> </td>
</tr>
<tr>
<td>HTTP status return code            </td>
<td>Leverage HTTP Status</td>
<td> </td>
</tr>
<tr>
<td>Is using rate limiter system       </td>
<td>✅ 429</td>
<td> </td>
</tr>
<tr>
<td>Is using cache system              </td>
<td>🚫</td>
<td>Keep it simple, use dynamic data, remove caching capabilities</td>
</tr>
<tr>
<td>Is validate UserAgent              </td>
<td>✅</td>
<td> </td>
</tr>
<tr>
<td>Is validate  Referrral             </td>
<td>🚫</td>
<td> </td>
</tr>
<tr>
<td><strong>Request</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Whether complex parameters are put into Form Fields or a separate JSON Body</td>
<td>Body</td>
<td> </td>
</tr>
<tr>
<td>Whether the subresource is a one-time query or an independent query        </td>
<td>one-time</td>
<td> </td>
</tr>
<tr>
<td>Paging parameter storage                                                   </td>
<td>URL Query</td>
<td> </td>
</tr>
<tr>
<td>Whether complex parameters are put into Form Fields or a separate JSON Body</td>
<td>Page</td>
<td> </td>
</tr>
<tr>
<td>Whether the subresource is a one-time query or an independent query        </td>
<td>Client</td>
<td>Reduce server-side costs and tolerate extreme case gaps</td>
</tr>
<tr>
<td><strong>Response</strong></td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>Model presentation types                                 </td>
<td>Multi</td>
<td>BO / VO / Tiny / Rich</td>
</tr>
<tr>
<td>How large models contain sub-model models                </td>
<td>Core Model + Multiple Linked Resource Queries</td>
<td> </td>
</tr>
<tr>
<td>Whether field returns are on-demand or grouped or unified</td>
<td>Unified</td>
<td>Tiny Model (optional) / Model (default) / Rich Model (optional)</td>
</tr>
<tr>
<td>field presentation format                                </td>
<td>Snake</td>
<td> </td>
</tr>
<tr>
<td>Error code                                               </td>
<td>None</td>
<td>Note: Many scenarios require only message</td>
</tr>
<tr>
<td>Error format                                             </td>
<td>Uniform</td>
<td> </td>
</tr>
<tr>
<td>Time Zone                                                </td>
<td>ISO 8601</td>
<td>Use only one format, no longer support multiple options</td>
</tr>
<tr>
<td>HATEOAS</td>
<td>🚫</td>
<td> </td>
</tr>
</tbody>
</table>
<h2 id="off-topic---an-interesting-design-for-apple-music">Off-Topic - An Interesting Design for Apple Music<a hidden class="anchor" aria-hidden="true" href="#off-topic---an-interesting-design-for-apple-music">#</a></h2>
<p>




<img loading="lazy" src="/images/202304/apple-music.png" alt="Apple Music"  />


</p>
<p><small>image from Apple Music</small></p>
<p>I was recently using Apple Music and noticed the URL structure of its web page:</p>
<p><code>/cn/album/we-sing-we-dance-we-steal-things/277635758?l=en</code></p>
<p>Looking closely at this URL structure, I can see that the Path contains human-readable slug in three parts: <code>alumn/$(name)/$(id)</code> (which contains the ID).
A question immediately occurred to me: are the intermediate readable names machine-sensitive and purely geared towards natural humans?
So I tested a fabricated address: <code>/cn/album/foobar/277635758?l=en</code>.
Can you guess if the result is accessible before you try to access it?</p>
<p>This design paradigm is a bit more complex than my current common URL design specification. My specification requires that the resource locale be organized using a two-level slug, <code>$(type)/$(id)</code>.
Whereas Apple uses <code>$(type)/(type-id)/$(id)</code>, taking care of both readability and accuracy.</p>
<h2 id="off-topic---why-graphql-doesnt-work">Off-Topic - Why GraphQL Doesn&rsquo;t Work<a hidden class="anchor" aria-hidden="true" href="#off-topic---why-graphql-doesnt-work">#</a></h2>
<p><a href="https://graphql.org/">GraphQL</a> is a way to request APIs by using a custom query language, which has the advantage of providing a more flexible way to fetch data.
Compared to RESTful APIs that require a single request for all the data needed, GraphQL allows the client to explicitly specify the data needed, thus reducing unnecessary data transfer and processing.</p>
<p>However, GraphQL&rsquo;s over-flexibility is also one of its drawbacks. Since it does not have some specifications for modeling business scenarios like the REST API, developers need to think about data processing themselves.
developers need to think about how to handle the data themselves.
This can lead to unreasonable query requests that can put excessive pressure on the back-end database. In addition, GraphQL has relatively few implementations and documentation, which also requires more learning costs.</p>
<p>Therefore, while GraphQL can provide better results in some specific scenarios, it is not suitable for all API design needs.
In fact, some companies have even chosen to drop support for GraphQL, such as Github&rsquo;s <a href="https://github.blog/changelog/2022-08-18-deprecation-notice-graphql-for-packages/">some projects</a>.</p>
<h2 id="last">Last<a hidden class="anchor" aria-hidden="true" href="#last">#</a></h2>
<blockquote>
<p>Complexity is incremental</p>
<ul>
<li>John Ousterhout (<a href="https://web.stanford.edu/~ouster/cgi-bin/cs190-winter18/lecture.php?topic=complexity">via</a>）</li>
</ul>
</blockquote>
<p><mark>There is no best style, only the best fit, but it is important to have style. &lt;/mark</p>
<p>Building a good rule requires not only a deep understanding of existing mechanisms, but also a thorough grasp of the business domain, and effective collaboration and communication within the team to promote and implement the rule.
Once established, however, rules can effectively reduce the complexity of the system, avoiding increasing complexity over time and as the business progresses, and reducing communication costs on the R&amp;D side.</p>
<p>It&rsquo;s a long-term investment, but one that will pay off in the long run. I hope those with a long-term view will take note of this article.</p>
<p>Key reference documents:</p>
<ul>
<li>[api-guidelines/Guidelines.md at master - microsoft/api-guidelines](<a href="https://github.com/Microsoft/api-guidelines/blob/master/">https://github.com/Microsoft/api-guidelines/blob/master/</a> Guidelines.md)</li>
<li><a href="https://docs.github.com/en/rest/overview/about-githubs-apis?apiVersion=2022-11-28">GitHub&rsquo;s APIs</a></li>
<li>[Web API design best practices - Azure Architecture Center | Microsoft Learn](<a href="https://learn.microsoft.com/en-us/azure/architecture/best-">https://learn.microsoft.com/en-us/azure/architecture/best-</a> practices/api-design)</li>
<li><a href="https://developer.aliyun.com/article/701810">Reflections on API Design Best Practices - Valley Park</a></li>
</ul>

<hr />
<p>原文链接: <a href="https://en.blog.alswl.com/2023/04/web-api-guidelines/">Pragmatic web API guidlines | Log4D</a></p>
<p>3a1ff193cee606bd1e2ea554a16353ee</p>
<p>欢迎关注我的微信公众号：<a
href="http://mp.weixin.qq.com/mp/getmasssendmsg?__biz=MzIyNTIwMTU3MQ==#wechat_webview_type=1&amp;wechat_redirect">窥豹</a></p>
<figure>
<img
src="https://d05fae.dijingchao.com/upload_dropbox/201605/qrcode_for_gh_17e2f9c2caa4_258.jpg"
alt="窥豹" />
<figcaption aria-hidden="true">窥豹</figcaption>
</figure>

    
  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://en.blog.alswl.com/tags/rest/">rest</a></li>
      <li><a href="https://en.blog.alswl.com/tags/api/">api</a></li>
      <li><a href="https://en.blog.alswl.com/tags/http/">http</a></li>
      <li><a href="https://en.blog.alswl.com/tags/guidelines/">Guidelines</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://en.blog.alswl.com/2023/02/gtd/">
    <span class="title">Next »</span>
    <br>
    <span>From Toodledo To Obsidian Tasks - my GTD best practices</span>
  </a>
</nav>

  </footer><script src="https://utteranc.es/client.js"
        repo="alswl/en.blog.alswl.com"
        issue-term="pathname"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://en.blog.alswl.com">Log4D</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
